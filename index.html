<!DOCTYPE html>
<html>
<script>
    (function(i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function() {
            (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
            m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
    })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
    //'//www.google-analytics.com/analytics.js'

    ga('create', 'UA-61261286-1', 'auto');
    ga('send', 'pageview');
</script>

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=gb18030">
    <title>Map of US Property Values Per Square Foot - Metrocosm</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="icon" href="http://metrocosm.com/wp-content/uploads/2015/03/M.png" type="image/x-icon" />
    <link rel="canonical" href="http://metrocosm.com/3d-map-us-real-estate/" />
    <!-- <link rel='stylesheet' id='font-awesome-css' href='font-awesome.min.css' type='text/css' media='all' /> -->
    <script src="https://use.fontawesome.com/8f069f95e2.js"></script>
    <!-- http://metrocosm.com/wp-content/plugins/js_composer/assets/lib/bower/font-awesome/css/font-awesome.min.css -->

    <style>
        body,
        html {
            background-color: rgb(0, 0, 0);
            margin: 0;
            padding: 0;
            border: 0;
            width: 100%;
        }

        canvas {
            position: absolute;
        }

        #cv {
            position: absolute;
            margin: 0;
            padding: 0;
            border: 0;
        }

        .popover {
            color: white;
            position: absolute;
            top: 0px;
            left: 0px;
            margin-left: 2%;
            z-index: 1060;
            display: none;
            width: 100% padding: 1px;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            font-style: normal;
            font-weight: 400;
            line-height: 1em;
            /*    text-align: left;
    text-align: start;*/
            text-align: left;
            text-decoration: none;
            text-shadow: none;
            text-transform: none;
            letter-spacing: normal;
            word-break: normal;
            word-spacing: normal;
            word-wrap: normal;
            white-space: nowrap;
            background-color: rgba(0, 0, 0, 0.1);
            /*#fff;*/
            -webkit-background-clip: padding-box;
            background-clip: padding-box;
            border: 1px solid #ccc;
            border: 1px solid rgba(0, 0, 0, .2);
            border-radius: 6px;
            -webkit-box-shadow: 0 5px 10px rgba(0, 0, 0, .2);
            box-shadow: 0 5px 10px rgba(0, 0, 0, .2);
            line-break: auto;
        }

        .popover-title {
            width: 100%;
            padding: 0px 14px;
            margin: 0;
            font-size: 32px;
            text-align: left;
            background-color: transparent;
            /*#f7f7f7;*/
            border-bottom: 0px solid #ebebeb;
            border-radius: 5px 5px 0 0;
            white-space: nowrap;
            margin-top: 32px;
            line-height: 1em;
        }

        .popover-content {
            display: inline-block;
            line-height: 1em;
            background-color: transparent;
            width: 100%;
            text-align: left;
            padding: 0px 14px;
            margin-top: 26px;
            white-space: nowrap;
        }

        .ppsqft {
            font-size: 26px;
        }

        .social {
            position: fixed;
            right: 1%;
            top: 1%;
            margin-top: 10px;
            margin-right: 10px;
        }

        .social .fa {
            transition: all .2s ease-in-out;
            color: white;
            display: inline-block;
            margin: auto 6px;
            text-align: center;
            position: static;
            text-decoration: none;
        }

        .fafa {
            border-radius: 30px;
            height: 30px;
            line-height: 30px;
            width: 30px;
            font-size: 20px;
        }

        .social .fa:hover {
            transform: scale(1.1);
        }

        .fa-twitter {
            background-color: #46c0fb;
            /*rgb(120,120,120);*/
        }

        .fa-twitter:hover {}

        .fa-facebook {
            background-color: rgb(59, 89, 152);
        }

        .fa-facebook:hover {}

        .metrocosm {
            transition: all .2s ease-in-out;
            color: #fff;
            display: inline-block;
            margin: auto 16px auto 3px;
            font-weight: 700;
            text-align: center;
            position: static;
            text-decoration: none;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #ff7433;
        }

        .metrocosm:hover {
            transform: scale(1.1);
        }

        .fa-eye {
            background-color: #ff7433;
        }

        .fa-info {
            background-color: #aa23bf;
        }

        div.floating {
            font-size: 12pt;
            color: #ffffff;
            background: #000000;
            opacity: 0.8;
            width: auto;
            height: auto;
            position: fixed;
            right: 10%;
            top: 10%;
            left: 10%;
            border: 1px solid #555555;
            padding: 1.5% 4%;
            display: none;
            overflow: auto;
            z-index: 99999999;
            display: none;
        }

        .close {
            color: orange;
            font-size: 15pt;
            font-weight: 900;
            cursor: pointer;
            text-decoration: underline;
        }
    </style>

    <meta property="og:url" content="http://metrocosm.com/3d-map-us-real-estate/" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="Mapping America's Hottest Housing Markets" />
    <meta property="og:description" content="This 3D map shows the cost of housing by U.S. county. The height of each county represents the average price per square foot of its homes." />
    <meta property="og:image" content="http://metrocosm.com/wp-content/uploads/2016/09/us-housing.png" />
    <meta name="description" content="This 3D map shows the cost of housing by U.S. county. The height of each county represents the average price per square foot of its homes." />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Mapping America's Hottest Housing Markets" />
    <meta name="twitter:description" content="This 3D map shows the cost of housing by U.S. county. The height of each county represents the average price per square foot of its homes." />
    <meta name="twitter:site" content="@galka_max" />
    <meta name="twitter:image" content="http://metrocosm.com/wp-content/uploads/2016/09/us-housing.png" />
    <meta name="twitter:creator" content="@galka_max" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>

    <!-- Facebook Pixel Code -->
    <script>
        ! function(f, b, e, v, n, t, s) {
            if (f.fbq) return;
            n = f.fbq = function() {
                n.callMethod ?
                    n.callMethod.apply(n, arguments) : n.queue.push(arguments)
            };
            if (!f._fbq) f._fbq = n;
            n.push = n;
            n.loaded = !0;
            n.version = '2.0';
            n.queue = [];
            t = b.createElement(e);
            t.async = !0;
            t.src = v;
            s = b.getElementsByTagName(e)[0];
            s.parentNode.insertBefore(t, s)
        }(window,
            document, 'script', 'https://connect.facebook.net/en_US/fbevents.js');

        fbq('init', '1673005169651763');
        fbq('track', "PageView");
    </script>
    <noscript><img height="1" width="1" style="display:none" src="https://www.facebook.com/tr?id=1673005169651763&ev=PageView&noscript=1" /></noscript>
    <!-- End Facebook Pixel Code -->

</head>

<body>
    <div class="floating" id="floating">
        <p>Based on data from <a href="http://www.zillow.com/research/data/" style="color:orange;">Zillow</a>, this map shows the cost of housing by U.S. county. The height of each county represents the average price per square foot.</p>
        <p style="margin-bottom: 4px;">To navigate around the map with a mouse:</p>
        <ul style="margin-top: 0;">
            <li><strong>Rotate</strong>: left mouse button + drag</li>
            <li><strong>Pan</strong>: right mouse button + drag</li>
            <li><strong>Zoom</strong>: middle mouse button (or both buttons at the same time) + drag</li>
        </ul>
        <em><p>For more information, see the full post: <a href="http://metrocosm.com/3d-map-us-real-estate/" style="color:orange;">Mapping America's Hottest Housing Markets</a></p></em>
        <p onclick="closeabout()" class="close">Close</p>
    </div>

    <div id="cv"></div>

    <div class="popover" style="display: block;pointer-events:none;">
        <div class="arrow"></div>
        <h3 class="popover-title">United States</h3>
        <div class="popover-content"><span class="ppsqft">Avg price per sqft: <strong>$132</strong></span></div>
    </div>

    <div style="position:fixed;bottom:3%;color:white;left:2%;" class="popover-content">
        <input id="labels" type="checkbox" name="labels" value="labels">Labels</div>

    <div class="social">
        <div class="fa fa-info fafa" title="What is this?" onclick="about()"></div>
        <a class="metrocosm fafa" title="Read the full post: Mapping America's Hottest Housing Markets" href="http://metrocosm.com/3d-map-us-real-estate/">M</a>

        <a class="fa fa-facebook fafa" href="https://www.facebook.com/sharer/sharer.php?u=http://metrocosm.com/us-housing-markets-map.html&t=" title="Share on Facebook" target="_blank" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=' + encodeURIComponent(document.URL) + '&t=' + encodeURIComponent(document.URL)); return false;"></a>
        <a class="fa fa-twitter fafa" href="https://twitter.com/share?text=Mapping+America&#39;s+Hottest+Housing+Markets&url=http://metrocosm.com/us-housing-markets-map.html" target="_blank" title="Share on Twitter"></a>
    </div>

    <script>
        resizetext();

        var mob = 0;

        var sceneWidth = 200;

        var valueFactor = 0.02;
        var width = window.innerWidth;
        var height = window.innerHeight;

        var floatingDiv;

        $(document).ready(function() {

            function cscale(t) {

                var jenkscolor = d3.scaleLinear()
                    .domain([1401, 601, 487, 306, 174, 107, 61, 16, 0])
                    .range([1, 0.87, 0.75, 0.62, 0.50, 0.37, 0.25, 0.12, 0.10]);

                return d3.interpolateInferno(jenkscolor(t));
            }

            function escale(t) {

                var emscale = d3.scaleLinear()
                    .domain([1401, 601, 487, 306, 174, 107, 61, 16, 0])
                    .range([1, 0.8, 0.6, 0.4, 0.2, 0.1, 0.05, 0.01, 0]);

                var finalscale = d3.scaleLinear()
                    .domain([0, 1])
                    .range(["black", cscale(t)]);

                return finalscale(emscale(t));
            }

            var scene = new THREE.Scene();

            var camera = new THREE.PerspectiveCamera(20, width / height, 0.1, 1100);
            camera.position.set(0, -200, 400);
            var controls = new THREE.TrackballControls(camera);

            controls.minDistance = 30;
            controls.maxDistance = 1000;
            controls.rotateSpeed = 1;

            var renderer = new THREE.WebGLRenderer({
                alpha: true
            });
            renderer.setSize(width, height);

            document.querySelector("#cv").appendChild(renderer.domElement);

            var plane = new THREE.Mesh(
                new THREE.PlaneGeometry(sceneWidth, 130, 10, 10),
                //new THREE.MeshLambertMaterial({color: "rgb(30,30,30)"})
                new THREE.MeshLambertMaterial({
                    opacity: 1,
                    transparent: true,
                    color: "rgb(24,24,24)",
                    emissive: "rgb(0,0,0)",
                    side: THREE.DoubleSide
                })
            );
            scene.add(plane);

            var line_material = new THREE.LineBasicMaterial({
                    color: 0x404040
                }),
                geometry = new THREE.Geometry(),
                floor = 0.1,
                step = 5;

            for (var i = 7; i <= 33; i++) {

                geometry.vertices.push(new THREE.Vector3(-100, floor, i * step - 100));
                geometry.vertices.push(new THREE.Vector3(100, floor, i * step - 100));
            }

            for (var i = 0; i <= 40; i++) {
                geometry.vertices.push(new THREE.Vector3(i * step - 100, floor, -65));
                geometry.vertices.push(new THREE.Vector3(i * step - 100, floor, 65));
            }

            var line = new THREE.LineSegments(geometry, line_material);
            line.rotation.x = Math.PI / 2;
            scene.add(line);

            var pointLight = new THREE.PointLight(0xFFFFFF, 2);
            pointLight.position.x = -300;
            pointLight.position.y = -100;
            pointLight.position.z = 300;

            scene.add(pointLight);

            var pointLight2 = new THREE.PointLight(0xFFFFFF, 0.4);
            pointLight2.position.x = 300;
            pointLight2.position.y = -100;
            pointLight2.position.z = 300;

            scene.add(pointLight2);

            controls.update();
            renderer.render(scene, camera);

            var raycaster = new THREE.Raycaster();
            var mouse = new THREE.Vector2(),
                INTERSECTED;

            d3.json("data/taiwan2.json", function(error, saved) {

                console.log("try to normalize:", saved);
                saved = extract(saved);
                console.log("new saved:", saved);

            // d3.json("usa-ppsqft.json", function(error, saved) {

                var temparr = [];

                // 單一地區, 共16xx個
                for (var i = 0; i < saved.actions.length; i++) {
                    var ppsf = (saved.data[i].ppsf / 1401);
                    var material = new THREE.MeshLambertMaterial({
                        opacity: 1,
                        transparent: true,
                        color: cscale(saved.data[i].ppsf),
                        emissive: escale(saved.data[i].ppsf),
                        side: THREE.DoubleSide
                    });


                    //material.color = new THREE.Color(cscale(saved.data[i].ppsf));
                    var shparr = [];

                    // 通常 ii只有一個(一個zone通常是只有一個block, 沒有離島之類的), ii=0, cruves[i][0] = array of (x,y)
                    for (var ii = 0; ii < saved.actions[i].length; ii++) {
                        var actions = saved.actions[i][ii];
                        var curves = saved.curves[i][ii];
                        var shp = new THREE.Shape();
                        shp.actions = actions;
                        shp.curves = curves;
                        shparr.push(shp)
                    }

                    shapeg1 = new THREE.ExtrudeGeometry(shparr, {
                        amount: (20 + ppsf * 3000) * valueFactor,
                        bevelEnabled: false
                    });

                    var shapeg1z = new THREE.BufferGeometry().fromGeometry(shapeg1);
                    var shapeg2c = new THREE.Mesh(shapeg1z, material);


                    shapeg2c.st = saved.data[i].st;
                    shapeg2c.ct = saved.data[i].ct;
                    shapeg2c.ppsf = saved.data[i].ppsf;


                    scene.add(shapeg2c);
                }

                saved = null;

                requestAnimationFrame(animate);

                onWindowResize();
            });

            var fontsizeg = 40;

            function makeTextSprite(message, parameters) {

                var scalefactor = 40;
                if (parameters === undefined) parameters = {};
                var fontface = parameters.hasOwnProperty("fontface") ? parameters["fontface"] : "Helvetica"; //"Arial";
                var fontsize = parameters.hasOwnProperty("fontsize") ? parameters["fontsize"] : 18;
                var borderThickness = parameters.hasOwnProperty("borderThickness") ? parameters["borderThickness"] : 4;
                var borderColor = parameters.hasOwnProperty("borderColor") ? parameters["borderColor"] : {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 1.0
                };
                var backgroundColor = parameters.hasOwnProperty("backgroundColor") ? parameters["backgroundColor"] : {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1.0
                };
                var textColor = parameters.hasOwnProperty("textColor") ? parameters["textColor"] : {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 1.0
                };

                var canvas = document.createElement('canvas');
                canvas.style.width = "410px";
                canvas.style.height = "40px";
                //        canvas.style.background-color = "white";
                var context = canvas.getContext('2d');
                context.font = "Bold " + fontsize + "px " + fontface;
                var metrics = context.measureText(message);
                var textWidth = metrics.width;

                var basewidth = context.measureText("aaaaaaaaaaaaaa").width;
                var xstart = (basewidth - textWidth) / 2;


                context.fillStyle = "rgba(" + backgroundColor.r + "," + backgroundColor.g + "," + backgroundColor.b + "," + 0 + ")";
                context.strokeStyle = "rgba(" + borderColor.r + "," + borderColor.g + "," + borderColor.b + "," + borderColor.a + ")";

                context.lineWidth = borderThickness;

                //        roundRect(context, metrics.width, fontsize);
                roundRecto(context, borderThickness / 2, borderThickness / 2, (textWidth + borderThickness) * 1.2, fontsize * 1.4 + borderThickness, 8);

                context.strokeStyle = "rgb(" + backgroundColor.r + "," + backgroundColor.g + "," + backgroundColor.b + ")";
                //        context.strokeText( message,  0, fontsize + borderThickness);

                context.strokeText(message, xstart, fontsize * 2.5);

                context.fillStyle = "rgba(" + textColor.r + ", " + textColor.g + ", " + textColor.b + ", 1.0)";
                //        context.fillText( message,  0, fontsize + borderThickness);

                context.fillText(message, xstart, fontsize * 2.5);


                var texture = new THREE.Texture(canvas)
                texture.needsUpdate = true;

                var spriteMaterial = new THREE.SpriteMaterial({
                    map: texture
                }); //( { map: texture, useScreenCoordinates: false } );
                var sprite = new THREE.Sprite(spriteMaterial);
                sprite.scale.set(0.5 * scalefactor, 0.25 * scalefactor, 0.75 * scalefactor);
                return sprite;
            }

            function roundRecto(ctx, x, y, w, h, r) {
                ctx.beginPath();
                ctx.moveTo(x + r, y);
                ctx.lineTo(x + w - r, y);
                ctx.quadraticCurveTo(x + w, y, x + w, y + r);
                ctx.lineTo(x + w, y + h - r);
                ctx.quadraticCurveTo(x + w, y + h, x + w - r, y + h);
                ctx.lineTo(x + r, y + h);
                ctx.quadraticCurveTo(x, y + h, x, y + h - r);
                ctx.lineTo(x, y + r);
                ctx.quadraticCurveTo(x, y, x + r, y);
                ctx.closePath();
                ctx.fill();
                ctx.stroke();
            }


            function roundRect(ctx, w, h) {
                ctx.beginPath();
                ctx.lineWidth = "6";
                ctx.strokeStyle = "red";
                ctx.rect(0, 0, w, h);
                ctx.closePath();
                ctx.stroke();
            }


            //function addlabels() {

            var bufferz = 340;

            var spritey2 = makeTextSprite("San Francisco", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(-84, 9, (bufferz + (878 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            spritey2 = makeTextSprite("New York", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(70, 17, (bufferz + (1397 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            spritey2 = makeTextSprite("Honolulu", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(-42, -43, (bufferz + (490 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            spritey2 = makeTextSprite("Boston", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(77, 26, (bufferz + (447 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            spritey2 = makeTextSprite("Key West", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(58, -50, (bufferz + (405 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);


            spritey2 = makeTextSprite("D.C.", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(63, 7, (bufferz + (477 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);


            spritey2 = makeTextSprite("Los Angeles", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(-74, -9, (bufferz + (370 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            spritey2 = makeTextSprite("Seattle", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(-70, 48, (bufferz + (292 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            spritey2 = makeTextSprite("Aspen", {
                fontsize: fontsizeg,
                borderColor: {
                    r: 0,
                    g: 0,
                    b: 0,
                    a: 0
                },
                backgroundColor: {
                    r: 20,
                    g: 20,
                    b: 20,
                    a: 0.5
                },
                textColor: {
                    r: 255,
                    g: 255,
                    b: 255,
                    a: 1
                }
            });
            spritey2.position.set(-33, 5, (bufferz + (841 / 1400) * 3000) * valueFactor);
            scene.add(spritey2);

            //}


            spritey2 = null;

            d3.select("#labels").on("click", labelchg);

            labelchg();

            function labelchg() {

                var setval = false;
                var l = document.getElementById("labels");
                if (l.checked == true) {
                    var setval = true
                }

                var labelarr = scene.children.slice().splice(4, 9);

                for (var k = 0; k < labelarr.length; k++) {
                    labelarr[k].visible = setval;
                }

            }

            window.addEventListener('resize', onWindowResize, false);

            function onWindowResize() {

                windowHalfX = window.innerWidth / 2;
                windowHalfY = window.innerHeight / 2;

                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();

                renderer.setSize(window.innerWidth, window.innerHeight);
                resizetext();
            }

            document.addEventListener('mousemove', onDocumentMouseMove, false);

            function onDocumentMouseMove(event) {

                event.preventDefault();

                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(event.clientY / window.innerHeight) * 2 + 1;
            }

            raycaster.setFromCamera(mouse, camera);

            function animate(time) {
                controls.update();
                renderer.render(scene, camera);

                raycaster.setFromCamera(mouse, camera);
                var cloneArray = scene.children.slice();

                //cloneArray.splice(0, 4);
                cloneArray.splice(0, 13);

                var intersects = raycaster.intersectObjects(cloneArray);

                if (intersects.length > 0 && mob == 0) {

                    if (intersects[0].object.ct == "Barbour" || intersects[0].object.ct == "Aleutians East") {

                        if (INTERSECTED) INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex);

                        INTERSECTED = null;

                    } else {

                        if (INTERSECTED != intersects[0].object) {

                            if (INTERSECTED) INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex);

                            INTERSECTED = intersects[0].object;
                            INTERSECTED.currentHex = INTERSECTED.material.emissive.getHex();
                            INTERSECTED.material.emissive.setHex(0x00bb00);

                        }
                    }
                } else {
                    if (INTERSECTED) INTERSECTED.material.emissive.setHex(INTERSECTED.currentHex);

                    INTERSECTED = null;
                }

                hidePopover();

                if (INTERSECTED !== null) {
                    if (mob == 0) {
                        showPopover(INTERSECTED.st, INTERSECTED.ct, INTERSECTED.ppsf);
                    }
                }

                requestAnimationFrame(animate);
            }
        });

        function showPopover(st, ct, ppsf) {

            $(".popover-title").text(ct + ", " + st);
            $(".ppsqft").html("Avg price per sqft: <strong>$" + Math.round(ppsf) + "</strong>");
        }

        function hidePopover(st, ct, ppsf) {

            $(".popover-title").text("United States");
            $(".ppsqft").html("Avg price per sqft: <strong>$132</strong>");
        }

        function resizetext() {

            var wiw = window.innerWidth;
            if (wiw < 800) {
                $(".popover-title").css("font-size", "20px").css("margin-top", "18px");
                $(".ppsqft").css("font-size", "16px");
                $(".popover-content").css("margin-top", "14px");
            }
            if (wiw < 600) {
                $(".popover-title").css("font-size", "12px").css("margin-top", "8px");
                $(".ppsqft").css("font-size", "10px");
                $(".popover-content").css("margin-top", "6px");
            }
            if (wiw > 800) {

                $(".popover-title").css("font-size", "28px").css("margin-top", "28px");
                $(".ppsqft").css("font-size", "22px");
                $(".popover-content").css("margin-top", "18px");
                $(".fafa").css("border-radius", "30px").css("height", "30px").css("line-height", "30px").css("width", "30px").css("font-size", "20px");

            }
            if (wiw < 670) {
                $(".popover").css("display", "none");
                mob = 1;
                $(".fafa").css("border-radius", "30px").css("height", "30px").css("line-height", "30px").css("width", "30px").css("font-size", "20px");
                $(".close").css("font-size", "12pt");
                $(".floating").css("font-size", "10pt");
            }
            if (wiw > 670) {
                $(".popover").css("display", "initial");
                mob = 0;
                $(".fafa").css("border-radius", "40px").css("height", "40px").css("line-height", "40px").css("width", "40px").css("font-size", "26px");
                $(".close").css("font-size", "15pt");
                $(".floating").css("font-size", "12pt");
            }
        }

        function about() {
            document.querySelector("#floating").style.display = 'block';
        }

        function closeabout() {
            document.querySelector("#floating").style.display = 'none';
        }
    </script>

    <script src="helper.js"></script>

    <!-- <script src="//d3js.org/d3.v4.js"></script> -->
    <script src="https://d3js.org/d3.v4.min.js"></script>

    <!-- <script src="//metrocosm.com/threed3no/three.min.js"></script> -->
    <script src="three.min.js"></script>

    <!-- <script src="//metrocosm.com/threed3no/TrackballControls.js"></script> -->
    <script src="TrackballControls.js"></script>

</body>

</html>
